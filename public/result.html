<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ÂØæÂ±ÄÁµêÊûú</title>
<link rel="stylesheet" href="script/style.css">
<style>
    body {
        background-color: #222;
        color: white;
        text-align: center;
        overflow-y: auto; /* Á∏¶„Çπ„ÇØ„É≠„Éº„É´Ë®±ÂèØ */
        font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    }

    /* ÂÖ®‰Ωì„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„Ç≥„É≥„ÉÜ„Éä */
    .result-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    /* ÂãùÊïó„ÉÜ„Ç≠„Çπ„Éà */
    #resultTitle {
        font-size: 4rem;
        font-weight: 900;
        margin: 20px 0;
        text-shadow: 0 0 10px rgba(0,0,0,0.8);
        animation: popIn 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        opacity: 0;
        transform: scale(0.5);
    }
    
    .res-win { color: #ffeb3b; text-shadow: 0 0 20px #ff4500; }
    .res-lose { color: #87ceeb; text-shadow: 0 0 20px #0000cd; }
    .res-draw { color: #ccc; }

    @keyframes popIn {
        100% { opacity: 1; transform: scale(1); }
    }

    /* „Ç≠„É£„É©„ÇØ„Çø„ÉºÁîªÂÉè„Ç®„É™„Ç¢ */
    .char-display {
        position: relative;
        width: 300px;
        height: 300px;
        margin: 10px 0 30px 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* ËÉåÊôØ„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
    .char-bg-effect {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        z-index: 0;
        filter: blur(20px);
        opacity: 0.6;
    }
    
    #charImage {
        position: relative;
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        z-index: 1;
        drop-shadow: 5px 5px 10px rgba(0,0,0,0.8);
        transition: transform 0.3s;
    }
    #charImage:hover { transform: scale(1.05); }

    /* „Ç≠„É£„É©Âêç */
    #charName {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: -20px;
        margin-bottom: 20px;
        z-index: 2;
        text-shadow: 2px 2px 4px #000;
    }

    /* Ê£ãË≠ú„Ç®„É™„Ç¢ */
    .kifu-box {
        width: 90%;
        background: #fdf5e6; /* Â∞ÜÊ£ãÁõ§„Å£„ÅΩ„ÅÑËâ≤ */
        color: #333;
        padding: 15px;
        border-radius: 8px;
        border: 4px solid #8b4513;
        margin-bottom: 20px;
        text-align: left;
    }
    .kifu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #8b4513;
        padding-bottom: 5px;
        margin-bottom: 10px;
        font-weight: bold;
        color: #8b4513;
    }
    #kifuContent {
        height: 150px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 0.9rem;
        line-height: 1.6;
        white-space: pre-wrap;
    }

    /* „Éú„Çø„É≥„Ç∞„É´„Éº„Éó */
    .btn-group {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
        max-width: 300px;
    }
    
    .action-btn {
        padding: 15px;
        font-size: 1.2rem;
        font-weight: bold;
        color: white;
        background: #8b4513;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        transition: transform 0.1s, background 0.2s;
        text-decoration: none;
        display: block;
    }
    .action-btn:active { transform: scale(0.95); }
    .action-btn.home { background: #d32f2f; }
    .action-btn.copy { background: #1976d2; font-size: 1rem; padding: 10px; }

</style>
</head>
<body>

<div class="result-container">
    <div id="resultTitle">RESULT</div>

    <div class="char-display">
        <div id="charBg" class="char-bg-effect"></div>
        <img id="charImage" src="" alt="My Character">
    </div>
    <div id="charName"></div>

    <div class="kifu-box">
        <div class="kifu-header">
            <span>üìù ÂØæÂ±Ä„ÅÆË®òÈå≤</span>
            <button class="action-btn copy" onclick="copyKifu()">„Ç≥„Éî„Éº</button>
        </div>
        <div id="kifuContent"></div>
    </div>

    <div class="btn-group">
        <a href="home.html" class="action-btn home">„Éõ„Éº„É†„Å´Êàª„Çã</a>
    </div>
</div>

<script>
    window.addEventListener('load', () => {
        // 1. „Éá„Éº„Çø„ÅÆÂèó„ÅëÂèñ„Çä
        const result = sessionStorage.getItem('last_game_result'); // "WIN" or "LOSE" or "DRAW"
        const charId = sessionStorage.getItem('last_game_my_char');
        const kifuJson = sessionStorage.getItem('last_game_kifu');

        // 2. ÂãùÊïó„ÅÆË°®Á§∫
        const title = document.getElementById('resultTitle');
        const charBg = document.getElementById('charBg');

        if (result === 'WIN') {
            title.textContent = "YOU WIN!";
            title.classList.add('res-win');
            charBg.style.background = "radial-gradient(circle, rgba(255,215,0,0.8) 0%, rgba(255,69,0,0) 70%)";
            playAudio("shori.mp3");
        } else if (result === 'LOSE') {
            title.textContent = "YOU LOSE...";
            title.classList.add('res-lose');
            charBg.style.background = "radial-gradient(circle, rgba(135,206,235,0.8) 0%, rgba(0,0,139,0) 70%)";
            // playAudio("haiboku.mp3"); // „Åô„Åß„Å´„Ç≤„Éº„É†ÁµÇ‰∫ÜÊôÇ„Å´È≥¥„Å£„Å¶„ÅÑ„Çå„Å∞‰∏çË¶Å
        } else {
            title.textContent = "DRAW";
            title.classList.add('res-draw');
            charBg.style.background = "radial-gradient(circle, rgba(200,200,200,0.8) 0%, rgba(100,100,100,0) 70%)";
        }

        // 3. „Ç≠„É£„É©ÁîªÂÉè„ÅÆË°®Á§∫
        const img = document.getElementById('charImage');
        const nameDiv = document.getElementById('charName');
        const charData = getCharData(charId);
        
        if (charData) {
            img.src = charData.src;
            nameDiv.textContent = "‰ΩøÁî®„Ç≠„É£„É©: " + charData.name;
        } else {
            img.style.display = "none";
            nameDiv.textContent = "";
        }

        // 4. Ê£ãË≠ú„ÅÆË°®Á§∫
        const kifuDiv = document.getElementById('kifuContent');
        if (kifuJson) {
            try {
                const kifuArray = JSON.parse(kifuJson);
                kifuDiv.textContent = kifuArray.join("\n");
            } catch(e) {
                kifuDiv.textContent = "Ê£ãË≠ú„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü";
            }
        }
    });

    // „Ç≠„É£„É©„ÇØ„Çø„ÉºÊÉÖÂ†±„ÅÆÂÆöÁæ©Ôºàmain.js„Å™„Å©„ÅÆÂÜÖÂÆπ„Å®Âêà„Çè„Åõ„ÇãÔºâ
    function getCharData(id) {
        // ÁîªÂÉè„Éë„Çπ„ÅØ„ÅîËá™Ë∫´„ÅÆÁí∞Â¢É„Å´Âêà„Çè„Åõ„Å¶Ë™øÊï¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        // script/image/‚óã‚óã.png „ÅåÂü∫Êú¨ÊßãÊàê„Å®‰ªÆÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô
        if (id === 'char_a') return { src: 'script/image/char_a.png', name: 'ÁÜ±Ë°Ä' };
        if (id === 'char_b') return { src: 'script/image/char_b.png', name: 'ÂÜ∑Èùô' };
        if (id === 'char_d') return { src: 'script/image/char_d.png', name: 'Áî∫Áî∞' };
        // „Éá„Éï„Ç©„É´„Éà
        return { src: 'script/image/karui_1p.PNG', name: '„ÅÑ„Å§„ÇÇÈÄö„Çä' };
    }

    function copyKifu() {
        const text = document.getElementById('kifuContent').textContent;
        navigator.clipboard.writeText(text).then(() => {
            alert("Ê£ãË≠ú„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ");
        });
    }

    function playAudio(filename) {
        // ÁµêÊûúÁîªÈù¢„Å´ÂÖ•„Å£„ÅüÁû¨Èñì„Å´Èü≥„ÇíÈ≥¥„Çâ„Åó„Åü„ÅÑÂ†¥Âêà„Å´‰ΩøÁî®
        // const a = new Audio("script/audio/" + filename);
        // a.volume = 0.5;
        // a.play().catch(()=>{});
    }
</script>

</body>
</html>