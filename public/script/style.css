/* 1. フォントの読み込み（一番上に記述） */
@import url('https://fonts.googleapis.com/css2?family=Sawarabi+Mincho&display=swap');

/* 2. 基本フォント設定 */
td, .piece-text {
    font-family: 'Sawarabi Mincho', serif;
    font-weight: bold; 
}

/* 3. 文字のサイズ */
td { font-size: 28px; }

body {
  font-family: sans-serif;
  background: url('image/haikei.PNG'); 
  background-repeat: repeat; 
  display: flex;
  flex-direction: column;
  align-items: center; 
  padding: 20px;
}

#game { display: flex; gap: 20px; }
#center { text-align: center; }
#status { font-weight: bold; margin-bottom: 5px; }
#checkStatus { color: red; font-weight: bold; margin-bottom: 10px; }
.shogiban-outer {
    padding: 15px; /* ここが「枠」の太さになります */
    background-color: #e3c18d; /* 枠の色（木材の色） */
    background-image: url('image/shogiban.png'); /* 枠部分にも木目をつける */
    background-size: cover;
    
    /* 立体感を出すための境界線と影 */

    box-shadow: 
        offset 5px 5px 15px rgba(0,0,0,0.4), /* 全体の影 */
        inner 0 0 10px rgba(0,0,0,0.2);     /* 枠の内側の影 */
    
    display: inline-block;
    line-height: 0; /* 余計な隙間を消す */
}

/* 盤面（テーブル）のスタイル調整 */
table {
    border-collapse: collapse;
    /* 盤面部分は少し明るく、または別の木目画像にするとリアルです */

    background-size: 100% 100%;
    
    /* 盤面の周りを細い黒線で囲む */
    outline: 2px solid #000;
}


/* マスのサイズ設定 */
td { 
  width: 55px; 
  height: 60px; 
  
  /* 罫線を真っ黒ではなく、半透明の黒にして木目に馴染ませる */
  border: 1px solid rgba(0, 0, 0, 0.5); 
  
  text-align: center; 
  vertical-align: middle; 
  cursor: pointer; 
  user-select: none; 
  padding: 0; 
  position: relative; 
  
  /* ★重要：マスの背景を透明にして、下の木の画像が見えるようにする */
  background-color: transparent !important;
}

/* ★ハイブリッド方式：盤面の駒 */
.piece-container {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  background-image: url('image/koma.png'); 
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  filter: drop-shadow(3px 3px 4px rgba(0, 0, 0, 0.5));
}

.piece-text {
  font-size: 26px;
  color: #000;
  z-index: 2;
  margin-top: 5px; 
}

.piece-text.promoted { color: #d32f2f; }

td.selected {
  /* 木目が見えるように半透明のオレンジにする */
  background-color: rgba(255, 165, 0, 0.6) !important;
  box-shadow: inset 0 0 10px orange; /* 内側に光る演出はお好みで */
}
td.move {
  /* 移動可能場所は薄い黄色 */
  background-color: rgba(255, 255, 0, 0.4) !important;
}

/* --- 駒台の設定 --- */
.hand {
  width: 160px;
  height: 320px;
  border: 1px solid #333;
  display: flex;
  flex-direction: column;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
}

.hand.active {
  box-shadow: 0 0 15px 5px gold;
  border-color: gold;
}

.white-hand { background-image: url('image/karui_2p.PNG'); background-size: contain; }
.black-hand { background-image: url('image/karui_1p.PNG'); background-size: contain; }

/* ★★★ 重要：持ち駒エリアのレイアウト修正 ★★★ */
/* .hand div を削除し、ID指定に変更 */
#blackHand, #whiteHand {
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 4px;
  justify-items: center;
  align-content: start; 
  padding: 5px;
  width: 100%;
  height: 100%;
  flex-grow: 1;
}

.hand h3 {
  margin: 0 0 5px 0;
  font-size: 14px;
  text-align: center;
  color: black;
  text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;
}

/* ★★★ 重要：持ち駒のデザインと文字位置修正 ★★★ */
.hand-piece-container {
  width: 40px;
  height: 45px;
  display: block; /* ブロック要素にする */
  
  background-image: url('image/koma.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.5));
  
  cursor: pointer;
  position: relative; /* 基準点 */
}

/* 文字を強制的に真ん中に配置 */
.hand-piece-container .piece-text {
  font-family: 'Sawarabi Mincho', serif;
  font-weight: bold;
  font-size: 20px;
  color: #000;
  
  position: absolute; /* 絶対配置 */
  top: 50%;
  left: 50%;
  transform: translate(-50%, -40%); /* 中心補正 */
  z-index: 10; /* 最前面へ */
  
  width: 100%;
  text-align: center;
  margin: 0;
  padding: 0;
  pointer-events: none;
}

.hand-piece-container.selected { 
  filter: brightness(1.2) sepia(0.5);
  box-shadow: 0 0 5px orange; 
}

/* --- 以下共通スタイル --- */
#controls { margin-top: 10px; text-align: center; }
button { padding: 6px 12px; font-size: 14px; cursor: pointer; }

#game { display: flex; justify-content: center; align-items: center; gap: 20px; }

#kifu {
  width: 400px; height: 200px; overflow-y: auto; border: 1px solid #333;
  padding: 6px; background: #deb887; margin-top: 10px; font-size: 14px;
}

.side { display: flex; flex-direction: column; justify-content: space-between; height: 500px; }
.side.left { align-items: flex-end; }
.side.right { align-items: flex-start; }

#undoBtn {
  width: 160px; height: 160px; font-size: 36px; font-weight: bold; border-radius: 10px; cursor: pointer;
  background-image: url('image/hyoshiki_red.PNG'); background-size: cover; background-position: center;
  color: #0C2CB9; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;
  transition: all 0.3s;
}
#undoBtn:hover { background-image: url('image/hyoshiki.PNG'); box-shadow: 0 0 15px 5px red; }

#resignBtn {
  width: 160px; height: 80px; font-size: 36px; font-weight: bold; border-radius: 10px; cursor: pointer;
  background-image: url('image/hyoshiki.PNG'); background-size: cover; background-position: center;
  color: #B90C2C; text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;
  transition: all 0.3s;
}
#resignBtn:hover { background-image: url('image/hyoshiki_red.PNG'); box-shadow: 0 0 15px 5px blue; }

.moved {
  /* 木目が見えるように半透明の緑にする */
  background-color: rgba(113, 181, 105, 0.5) !important;
}

@keyframes flashGreenAnim { 0% { box-shadow: 0 0 50px 20px limegreen; border: 2px solid limegreen; } 100% { box-shadow: none; border: 1px solid #333; } }
@keyframes flashOrangeAnim { 0% { box-shadow: 0 0 50px 20px orange; border: 2px solid orange; } 100% { box-shadow: none; border: 1px solid #333; } }
.flash-green { animation: flashGreenAnim 2s ease-out forwards; }
.flash-orange { animation: flashOrangeAnim 2s ease-out forwards; }

#skillCutIn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; z-index: 1000; pointer-events: none; display: none; }
.cut-in-active { display: block !important; animation: cut-in-anim 2.5s ease-out forwards; }
@keyframes cut-in-anim { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); } 10% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); } }

.flash-silver { animation: flash-silver-anim 1.5s ease-out; }
.flash-red { animation: flash-red-anim 1.5s ease-out; }
.flash-blue { animation: flash-blue-anim 1.5s ease-out; }
@keyframes flash-silver-anim { 0% { background-color: transparent; } 10% { background-color: rgba(192,192,192,0.6); } 100% { background-color: transparent; } }
@keyframes flash-red-anim { 0% { background-color: transparent; } 10% { background-color: rgba(255,0,0,0.5); } 100% { background-color: transparent; } }
@keyframes flash-blue-anim { 0% { background-color: transparent; } 10% { background-color: rgba(0,191,255,0.5); } 100% { background-color: transparent; } }

.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 2000; }
.modal-content { background: #fff8dc; padding: 30px; border: 4px solid #8b4513; border-radius: 10px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
.modal-buttons { display: flex; gap: 20px; justify-content: center; }

#promoteModal .modal-content { background: #fff8dc; padding: 30px; border: 4px solid #8b4513; border-radius: 10px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
#promoteModal .modal-buttons { display: flex; gap: 20px; justify-content: center; }

.skill-targeting-mode { background-color: #d0f0c0 !important; border: 4px solid #32cd32 !important; box-shadow: 0 0 20px rgba(50, 205, 50, 0.8); transition: all 0.3s ease; }
body.view-white #board { transform: rotate(180deg); }
#shogi-board-container { position: relative; }
#start-notification { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; width: 200px; pointer-events: none; }

/* 移動前のマス（赤色・半透明） */
.move-from {
  background-color: rgba(255, 60, 60, 0.6) !important;
}

/* --- 後手（回転している駒）用の影補正 --- */

/* 盤面の駒（後手）: 影を左上(-3px)に設定 → 180度回転して右下に見える */
.piece-container.gote {
  filter: drop-shadow(-3px -3px 4px rgba(0, 0, 0, 0.5));
}

/* =========================================
   自分が後手（画面反転）の時の影補正
   ========================================= */

/* --- 1. 盤面の駒 --- */

/* 自分が後手の時の「先手の駒（相手）」 */
/* 画面が回転しているので、影を逆に(-3px)設定すると、見た目が右下になる */
body.view-white .piece-container:not(.gote) {
  filter: drop-shadow(-3px -3px 4px rgba(0, 0, 0, 0.5));
}

/* 自分が後手の時の「後手の駒（自分）」 */
/* 本来は逆影(.gote)だが、画面回転で一周して元に戻るため、正の影(3px)にする */
body.view-white .piece-container.gote {
  filter: drop-shadow(3px 3px 4px rgba(0, 0, 0, 0.5));
}


/* --- 2. 持ち駒 --- */

/* 自分が後手の時の「先手の持ち駒（相手）」 */
body.view-white .hand-piece-container:not(.gote) {
  filter: drop-shadow(-2px -2px 3px rgba(0, 0, 0, 0.5));
}

/* 自分が後手の時の「後手の持ち駒（自分）」 */
body.view-white .hand-piece-container.gote {
  filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.5));
}

/* 自分が後手の時の「後手の持ち駒（自分）選択中」 */
body.view-white .hand-piece-container.gote.selected {
  filter: brightness(1.2) sepia(0.5) drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.5));
}

/* 持ち駒（後手）: 通常時 */
.hand-piece-container.gote {
  filter: drop-shadow(-2px -2px 3px rgba(0, 0, 0, 0.5));
}

/* 持ち駒（後手）: 選択時（エフェクト＋反転影） */
.hand-piece-container.gote.selected {
  filter: brightness(1.2) sepia(0.5) drop-shadow(-2px -2px 3px rgba(0, 0, 0, 0.5));
}

/* --- 駒のサイズ補正（玉を1.0とした比率） --- */

/* 玉・王 (基準) */
.size-K { transform: scale(1.0); }

/* 飛・角 (0.968) */
.size-R, .size-B { transform: scale(0.968); }

/* 金・銀 (0.937) */
.size-G, .size-S { transform: scale(0.937); }

/* 桂 (0.905) */
.size-N { transform: scale(0.905); }

/* 香 (0.889) */
.size-L { transform: scale(0.889); }

/* 歩 (0.857) */
.size-P { transform: scale(0.857); }



/* チャットコンテナ */
#chatContainer {
  position: fixed;
  bottom: 0;
  right: 20px;
  width: 300px;
  background-color: rgba(255, 255, 255, 0.95);
  border: 2px solid #8b4513;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  z-index: 1000;
  font-family: sans-serif;
}

/* ヘッダー（開閉ボタン兼任） */
#chatHeader {
  background-color: #8b4513;
  color: white;
  padding: 10px;
  cursor: pointer;
  font-weight: bold;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  user-select: none;
}

/* チャット本体（最初は隠しておく設定も可） */
#chatBody {
  display: flex; /* none にすれば初期状態で閉じる */
  flex-direction: column;
  height: 250px;
}

/* 履歴表示エリア */
#chatHistory {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  border-bottom: 1px solid #ccc;
  font-size: 14px;
}

/* メッセージのスタイル */
.chat-msg { margin-bottom: 5px; }
.chat-name { font-weight: bold; color: #d35400; margin-right: 5px; }
.chat-text { color: #333; }
.chat-system { color: #888; font-style: italic; font-size: 12px; }

/* 入力エリア */
#chatInputArea {
  display: flex;
  padding: 5px;
}
#chatInput {
  flex: 1;
  padding: 5px;
  border: 1px solid #ccc;
  border-radius: 3px;
}
#chatInputArea button {
  margin-left: 5px;
  background-color: #28a745;
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 3px;
  cursor: pointer;
}
