<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ã—ãŠã‚„å°†æ£‹ - ãƒ›ãƒ¼ãƒ </title>
  <link rel="icon" href="script/image/komiya_icon.png"> 
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="script/image/komiya_icon.png">
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
      overflow: hidden;
      background-image: url('script/image/shogi_title.PNG');
      background-color: #2c3e50;
      background-size: cover;
      background-position: center;
      height: 100vh;
      width: 100vw;
    }

    /* å¹ãå‡ºã—æœ¬ä½“ã®è¨­å®š */
    .speech-bubble {
      display: none;             /* æœ€åˆã¯éš ã—ã¦ãŠãï¼ˆJSã§è¡¨ç¤ºã•ã›ã‚‹ï¼‰ */
      position: absolute;        /* ç”»é¢å…¨ä½“ã«å¯¾ã—ã¦è‡ªç”±ãªä½ç½®ã«é…ç½®ã™ã‚‹è¨­å®š */
      
      /* --- ä½ç½®èª¿æ•´ã®ãƒ¡ã‚¤ãƒ³ --- */
      bottom: 50vh;              /* ä¸‹ã‹ã‚‰æ•°ãˆã¦ã€Œç”»é¢ã®é«˜ã•ã®58%ã€ã®ä½ç½®ã«é…ç½®ï¼ˆå°ã•ãã™ã‚‹ã¨ä¸‹ã¸ï¼‰ */
      left: 50%;                 /* å·¦ã‹ã‚‰æ•°ãˆã¦ã€Œç”»é¢ã®å¹…ã®45%ã€ã®ä½ç½®ã«é…ç½®ï¼ˆã‚­ãƒ£ãƒ©ã®å·¦å³ä½ç½®ã«åˆã‚ã›ã‚‹ï¼‰ */
      transform: translateX(-50%); /* è‡ªåˆ†ã®å¹…ã®åŠåˆ†ã ã‘å·¦ã«ãšã‚‰ã—ã¦ã€leftã®ä½ç½®ã«ã€Œä¸­å¿ƒã€ã‚’åˆã‚ã›ã‚‹ */
      
      /* --- è¦‹ãŸç›®ã®è£…é£¾ --- */
      background: #fff8dc;       /* å¹ãå‡ºã—ã®ä¸­ã®è‰²ï¼ˆå’Œç´™ã£ã½ã„ãƒ™ãƒ¼ã‚¸ãƒ¥ï¼‰ */
      border: 3px solid #8b4513; /* 3pxã®å¤ªã•ã®ã€Œå®Ÿç·šã€ã§ã€ŒèŒ¶è‰²ã€ã®æ ç·š */
      border-radius: 20px;       /* è§’ã®ä¸¸ã¿ï¼ˆå¤§ããã™ã‚‹ã¨ã‚‚ã£ã¨ä¸¸ããªã‚‹ï¼‰ */
      padding: 12px 20px;        /* æ–‡å­—ã¨æ ç·šã®é–“ã®ä½™ç™½ï¼ˆä¸Šä¸‹12pxã€å·¦å³20pxï¼‰ */
      
      /* --- ã‚µã‚¤ã‚ºã®åˆ¶é™ --- */
      min-width: 160px;          /* æ¨ªå¹…ãŒã“ã‚Œã‚ˆã‚Šå°ã•ããªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ */
      max-width: 220px;          /* æ¨ªå¹…ãŒã“ã‚Œã‚ˆã‚Šå¤§ãããªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆè‡ªå‹•ã§æ”¹è¡Œã•ã‚Œã‚‹ï¼‰ */
      
      /* --- æ–‡å­—ã®ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
      color: #333;               /* æ–‡å­—ã®è‰²ï¼ˆæ¿ƒã„ã‚°ãƒ¬ãƒ¼ï¼‰ */
      font-weight: bold;         /* æ–‡å­—ã‚’å¤ªå­—ã«ã™ã‚‹ */
      font-size: 0.95rem;        /* æ–‡å­—ã®å¤§ãã• */
      
      /* --- ãã®ä»– --- */
      z-index: 100;              /* é‡ãªã‚Šé †ã€‚ã‚­ãƒ£ãƒ©(z-index:1)ã‚ˆã‚Šå¤§ãã„æ•°å­—ã«ã—ã¦æ‰‹å‰ã«å‡ºã™ */
      box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* ä¸‹æ–¹å‘ã«4pxã€ã¼ã‹ã—10pxã®å½±ã‚’ã¤ã‘ã‚‹ */
      pointer-events: none;      /* å¹ãå‡ºã—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã€Œä¸‹ã®ã‚­ãƒ£ãƒ©ã€ã«ã‚¯ãƒªãƒƒã‚¯ãŒå±Šãã‚ˆã†ã«ã™ã‚‹ */
      
      /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼špop-inã¨ã„ã†åå‰ã®å‹•ãã‚’0.3ç§’ã‹ã‘ã¦è¡Œã† */
      animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);

      white-space: pre-wrap;    /* â˜…ã“ã‚Œã‚’å…¥ã‚Œã‚‹ã¨ \n ãŒæ”¹è¡Œã¨ã—ã¦åæ˜ ã•ã‚Œã¾ã™ */
      line-height: 1.4;         /* æ”¹è¡Œã—ãŸæ™‚ã®è¡Œé–“ã‚’å°‘ã—åºƒã’ã‚‹ã¨èª­ã¿ã‚„ã™ã„ã§ã™ */
    }

    /* å¹ãå‡ºã—ã®ã€Œã—ã£ã½ï¼ˆä¸‰è§’ï¼‰ã€ã‚’ä¸Šå´ã«å¤‰æ›´ */
    .speech-bubble::after {
      content: '';
      position: absolute;
      
      /* --- ä¸‰è§’ã‚’å‡ºã™ä½ç½®ï¼ˆä¸Šå´ã«å¤‰æ›´ï¼‰ --- */
      top: auto;                 /* ä¸‹å´ã®æŒ‡å®šã‚’è§£é™¤ã™ã‚‹ãŸã‚ã«ä¸€å¿œè¨­å®š */
      bottom: 100%;              /* æœ¬ä½“ã®çœŸä¸Šï¼ˆå¤–å´ï¼‰ã«é…ç½® */
      left: auto;                /* å·¦å´ã®æŒ‡å®šã‚’è§£é™¤ */
      right: 20%;                /* å³ç«¯ã‹ã‚‰20%ã®ä½ç½®ï¼ˆå‘ãã«åˆã‚ã›ã¦èª¿æ•´ï¼‰ */
      
      /* --- ä¸‰è§’å½¢ã‚’ã€Œä¸Šå‘ãã€ã«ã™ã‚‹è¨­å®š --- */
      border-left: 10px solid transparent;  /* å·¦å´ã‚’é€æ˜ã« */
      border-right: 10px solid transparent; /* å³å´ã‚’é€æ˜ã« */
      border-top: none;                     /* ä¸‹å‘ãç”¨ã®è¨­å®šã‚’å‰Šé™¤ */
      border-bottom: 15px solid #8b4513;    /* ä¸‹å´ã®æ ç·šã«è‰²ã‚’ã¤ã‘ã‚‹ã¨ã€Œä¸Šå‘ãã€ã«ãªã‚Šã¾ã™ */
    }

    @keyframes pop-in {
      0% { transform: translateX(-50%) scale(0); opacity: 0; }
      100% { transform: translateX(-50%) scale(1); opacity: 1; }
    }

    /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰ */
    .character-stand {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      height: 85vh;
      width: auto;
      max-width: 95%;
      z-index: 1;
      content: url('script/image/komiya_touka.png'); 
      filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
      cursor: pointer; /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ */
      pointer-events: auto; /* ã‚¯ãƒªãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ– */
    }

    /* ä¸Šéƒ¨ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒãƒ¼ */
    .user-info-bar {
      position: absolute;
      top: 0;
      width: 100%;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
      z-index: 5;
    }
    .user-name { font-weight: bold; font-size: 1.1rem; }
    
    .top-btn {
      border: none;
      color: white;
      border-radius: 20px;
      padding: 5px 15px;
      font-size: 0.9rem;
      cursor: pointer;
      margin-left: 5px;
      font-weight: bold;
    }
    .stats-btn { background: #ff9800; }
    .news-btn { background: #28a745; }

    /* ä¸‹éƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .bottom-menu {
      position: absolute;
      bottom: 20px;
      width: 96%;
      left: 2%;
      display: flex;
      justify-content: space-around;
      align-items: flex-end;
      gap: 8px;
      z-index: 10;
    }

    .menu-btn {
      flex: 1;
      height: 60px;
      background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
      border: 2px solid white;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .menu-btn:active { transform: scale(0.95); }

    .menu-btn.main-action {
      background: linear-gradient(to bottom, #ff758c 0%, #ff7eb3 100%);
      height: 75px; 
      flex: 1.3;
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    .modal-box {
      background: #fff8dc;
      padding: 20px;
      border-radius: 10px;
      border: 4px solid #8b4513;
      text-align: center;
      width: 85%;
      max-width: 320px;
    }
    .sub-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 1.1rem;
      background: #8b4513;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="user-info-bar">
    <div>
      <span style="font-size:0.8rem; color:#ccc;">Player Name</span><br>
      <span id="userNameDisplay" class="user-name">ã‚²ã‚¹ãƒˆ</span> ã•ã‚“
      <button id="editNameBtn" onclick="showNameEditModal()" style="display:none; background:none; border:none; cursor:pointer; font-size:1rem;">âœï¸</button>
    </div>

    <div>
      <button class="top-btn news-btn" onclick="openModal('newsModal')">ãŠçŸ¥ã‚‰ã›</button>
      <button class="top-btn stats-btn" onclick="showMyStats()">æˆ¦ç¸¾</button>
      <button class="top-btn" style="background: #6c757d;" onclick="openModal('settingsMainMenu')">âš™ï¸</button>
    </div>
  </div>

  <div id="characterBubble" class="speech-bubble"></div>

  <img class="character-stand" src="script/image/char_a.png" alt="Character" onclick="talkCharacter()">

  <div class="bottom-menu">
    <button class="menu-btn" onclick="goToCharacterSelect('practice')">ã‚Œã‚“ã—ã‚…ã†</button>
    <button class="menu-btn" onclick="goToCharacterSelect('cpu')">ã²ã¨ã‚Šã§</button>
    <button class="menu-btn main-action" onclick="goToCharacterSelect('online')">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³<br>å¯¾æˆ¦</button>
    <button class="menu-btn" onclick="goToCharacterSelect('pvp')">ãµãŸã‚Šã§</button>
  </div>

  <div id="newsModal" class="overlay">
    <div class="modal-box">
      <h3 style="color:#d35400; margin-top:0;">ğŸ”” æœ€æ–°æƒ…å ±</h3>
      <div style="text-align: left; margin: 20px 0; line-height: 1.6; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 5px;">
        ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ å®Ÿè£…ï¼<br>
        ãƒ»æœ€å¼·CPUã€Œè©¦é¨“å®Ÿè£…ã€è¿½åŠ <br>
        ãƒ»æˆ¦ç¸¾ä¿å­˜æ©Ÿèƒ½ã«å¯¾å¿œ
      </div>
      <button onclick="closeModal('newsModal')" style="background: #ccc; border: none; color: black; padding: 10px 20px; border-radius: 5px; cursor: pointer;">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <div id="settingsMainMenu" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">è¨­å®š</h3>
      <button class="sub-btn" onclick="switchModal('settingsMainMenu', 'volumeMenu')">éŸ³é‡è¨­å®š</button>
      <button class="sub-btn" onclick="switchModal('settingsMainMenu', 'languageMenu')">è¨€èªè¨­å®š</button>
      <button class="sub-btn" onclick="openAccountFromSettings()">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</button>
      <button class="sub-btn" style="background:#666;" onclick="closeModal('settingsMainMenu')">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <div id="volumeMenu" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">éŸ³é‡è¨­å®š</h3>
      <div style="margin: 20px 0;">
        <p>BGM</p><input type="range" style="width:80%;">
        <p>åŠ¹æœéŸ³</p><input type="range" style="width:80%;">
      </div>
      <button class="sub-btn" style="background:#666;" onclick="switchModal('volumeMenu', 'settingsMainMenu')">ã‚‚ã©ã‚‹</button>
    </div>
  </div>

  <div id="languageMenu" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">è¨€èªè¨­å®š / Language</h3>
      <button class="sub-btn">æ—¥æœ¬èª</button>
      <button class="sub-btn" style="background:#555;">ã‚¹ãƒ¯ãƒ’ãƒªèªï¼ˆæº–å‚™ä¸­ï¼‰</button>
      <button class="sub-btn" style="background:#666;" onclick="switchModal('languageMenu', 'settingsMainMenu')">ã‚‚ã©ã‚‹</button>
    </div>
  </div>

  <div id="authModal" class="overlay">
    <div class="modal-box">
      <h2 id="authTitle" style="margin-top: 0; color: #8b4513;">ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h2>
      <div id="authInputs">
        <div style="text-align: left; margin: 15px 0;">
          <label>ãŠåå‰ï¼ˆæ–°è¦ç™»éŒ²æ™‚ã®ã¿ï¼‰</label><br>
          <input type="text" id="authName" placeholder="ã‚ãã‚‰" style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div style="text-align: left; margin: 15px 0;">
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><br>
          <input type="email" id="authEmail" placeholder="example@mail.com" style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div style="text-align: left; margin: 15px 0;">
          <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰</label><br>
          <input type="password" id="authPass" placeholder="******" style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;">
          <button onclick="loginUser()" style="background: #007bff; color: white; width: 45%; height: 40px; border:none; border-radius:5px;">ãƒ­ã‚°ã‚¤ãƒ³</button>
          <button onclick="registerUser()" style="background: #28a745; color: white; width: 45%; height: 40px; border:none; border-radius:5px;">æ–°è¦ç™»éŒ²</button>
        </div>
      </div>
      <div style="margin-top:20px; border-top:1px solid #ccc; padding-top:10px;">
         <button id="logoutBtnInModal" onclick="logoutUser(); closeAuthModal()" style="display:none; background: #6c757d; border:none; border-radius:5px; color: white; width: 100%; height: 40px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
      <button onclick="closeAuthModal()" style="margin-top: 15px; background: #ccc; border: none; padding: 5px 15px; border-radius: 5px;">ã‚‚ã©ã‚‹</button>
    </div>
  </div>

  <div id="nameEditModal" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">åå‰ã‚’å¤‰æ›´</h3>
      <div style="margin: 20px 0;">
        <input type="text" id="newNameInput" style="width: 80%; padding: 10px; font-size: 16px; border: 2px solid #8b4513; border-radius: 5px; text-align: center;">
      </div>
      <div style="display: flex; justify-content: space-around; gap: 10px;">
        <button onclick="saveNewName()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; flex: 1;">æ±ºå®š</button>
        <button onclick="closeNameEditModal()" style="background: #ccc; color: black; border: none; padding: 10px 20px; border-radius: 5px; flex: 1;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>

  <div id="statsModal" class="overlay">
    <div class="modal-box" style="max-height: 80vh; display: flex; flex-direction: column;">
      <h2 style="margin-top: 0; color: #8b4513;">ã‚ãªãŸã®æˆ¦ç¸¾</h2>
      <div style="display: flex; justify-content: space-around; font-size: 24px; margin-bottom: 15px;">
        <div style="color: red;">å‹: <span id="statsWin">0</span></div>
        <div style="color: blue;">æ•—: <span id="statsLose">0</span></div>
      </div>
      <div style="text-align: left; background: white; border: 1px solid #ccc; flex-grow: 1; overflow-y: auto; padding: 10px; margin-bottom: 15px;">
        <ul id="statsHistory" style="list-style: none; padding: 0; margin: 0;"></ul>
      </div>
      <button onclick="closeStatsModal()" style="background: #ccc; border: none; color: black; padding: 10px;">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <script src="script/auth.js"></script>
  <script>
    // --- ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ ---
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function switchModal(closeId, openId) { closeModal(closeId); openModal(openId); }

    function openAccountFromSettings() {
      closeModal('settingsMainMenu');
      showAuthModal(); 
    }

    // --- ç”»é¢é·ç§» ---
    function goToCharacterSelect(mode) { window.location.href = "character.html?mode=" + mode; }

    function startGame(difficulty) {
      let target = "";
      if (difficulty === 'saijaku') target = "cpu_tawamure.html";
      else if (difficulty === 'easy') target = "cpu_oasobi.html";
      else if (difficulty === 'normal') target = "cpu_tashinami.html";
      else if (difficulty === 'hard1') target = "cpu_komiya.html";
      else if (difficulty === 'hard2') target = "cpu_shioya.html";
      else if (difficulty === 'ex_hard1') target = "ex_cpu_komiya.html";
      else if (difficulty === 'ex_hard2') target = "ex_cpu_shioya.html";
      else if (difficulty === 'ex_hard3') target = "cpu_yaneuraou.html";
      if(target) window.location.href = target;
    }

// â˜…ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å–‹ã‚Šæ©Ÿèƒ½ï¼ˆã‚¨ãƒ©ãƒ¼ä¿®æ­£ç‰ˆï¼‰
    // â˜…ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å–‹ã‚Šæ©Ÿèƒ½ï¼ˆå¤‰æ•°åã®è¡çªã‚’å›é¿ã—ãŸä¿®æ­£ç‰ˆï¼‰
    let bubbleTimer = null;

    function talkCharacter() {
        const bubble = document.getElementById("characterBubble");
        const userName = document.getElementById("userNameDisplay").textContent || "ã‚²ã‚¹ãƒˆ";
        const now = new Date();
        const hour = now.getHours();

        // --- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ã‚»ãƒªãƒ•é›† ---
        const baseMessages = [
            
            // --- ã‚ªãƒªã‚¸ãƒŠãƒ« ï¼† åŸºæœ¬ ---
            `ãŠæ‰‹åˆã‚ã›ã€\nã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼\n${userName}ã•ã‚“ï¼`,
            `${userName}ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼\nä»Šæ—¥ã‚‚å°†æ£‹ã§ã™ã‹ï¼Ÿ`,
            `æ¬¡ã®ä¸€æ‰‹ã€\nã˜ã£ãã‚Šè€ƒãˆã¾ã—ã‚‡ã†â€¦`,
            `å°†æ£‹ã¯æ¥½ã—ã‚€ã“ã¨ãŒä¸€ç•ªã§ã™ã‚ˆã­ï¼\n${userName}ã•ã‚“ï¼`,
            `ã•ã‚ã€å¯¾å±€ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼\n${userName}ã•ã‚“ï¼`,
            `ã“ã“ã¯ã©ã“ã§ã—ã‚‡ã†ã‹â€¦ï¼Ÿ`,
            `å¯¾å±€ãŒçµ‚ã‚ã£ãŸã‚‰ã€\nã‚«ãƒ¬ãƒ¼ã‚’é£Ÿã¹ã¾ã—ã‚‡ã†â€¦`,

            // --- å°†æ£‹ãƒ»å¯¾å±€ ---
            `ä¸€æ­©åƒé‡‘â€¦\næ­©ã‚‚å¤§åˆ‡ã«ã—ã¾ã—ã‚‡ã†ã­ã€\n${userName}ã•ã‚“ã€‚`,
            `${userName}ã•ã‚“ã®å¾—æ„æˆ¦æ³•ã¯\nãªã‚“ã§ã™ã‹ï¼Ÿ`,
            `è©°å°†æ£‹ãŒè§£ã‘ã‚‹ã¨ã€\né ­ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ã‚ˆã­ï¼`,
            `è² ã‘ã¦ã‚‚è…ã‚‰ãšã€\næ¬¡ã®ä¸€æ‰‹ã‚’è¦‹æ®ãˆã¾ã—ã‚‡ã†ã€‚`,
            `æ”»ã‚ã‚‹æ™‚ã¯å¤§èƒ†ã«ã€\nå®ˆã‚‹æ™‚ã¯æ…é‡ã«ã€ã§ã™ã‚ˆã€‚`,
            `äºŒæ­©ã«ã ã‘ã¯æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ã­ï¼`,
            `${userName}ã•ã‚“ã¨æŒ‡ã™æ™‚é–“ã¯ã€\nç§ã«ã¨ã£ã¦å®ç‰©ã§ã™ã€‚`,
            `ç‹æ‰‹ï¼ã¨ã„ããŸã„ã¨ã“ã‚ã§ã™ãŒã€\nã¾ãšã¯è½ã¡ç€ãã¾ã—ã‚‡ã†ã€‚`,

            // --- æ—¥å¸¸ãƒ»æŒ¨æ‹¶ ---
            `ä»Šæ—¥ã‚‚ä¸€æ—¥ã€\nãŠç–²ã‚Œæ§˜ã§ã™ã€${userName}ã•ã‚“ã€‚`,
            `${userName}ã•ã‚“ã€\nå°‘ã—ä¼‘æ†©ã—ã¾ã›ã‚“ã‹ï¼Ÿ\nãŠèŒ¶ã‚’æ·¹ã‚Œã¾ã™ã­ã€‚`,
            `å¤–ã®ç©ºæ°—ã¯ã€\nä»Šã©ã‚“ãªæ„Ÿã˜ã§ã™ã‹ï¼Ÿ`,
            `å¤œæ›´ã‹ã—ã¯ç¦ç‰©ã§ã™ã‚ˆï¼Ÿ\nâ€¦ã¨è¨€ã„ã¤ã¤ã€\nå°†æ£‹ã—ã¡ã‚ƒã„ã¾ã™ã‚ˆã­ã€‚`,
            `${userName}ã•ã‚“ï¼\nä¼šã„ã«æ¥ã¦ãã‚Œã¦å¬‰ã—ã„ã§ã™ï¼`,
            `ãªã‚“ã ã‹ä»Šæ—¥ã¯ã€\nè‰¯ã„ã“ã¨ãŒã‚ã‚Šãã†ãªäºˆæ„Ÿã§ã™ï¼`,

            // --- ã‚«ãƒ¬ãƒ¼ãƒ»å¤©ç„¶ç³» ---
            `ç”»é¢ã®å‘ã“ã†å´ã£ã¦ã€\nã©ã‚“ãªæ™¯è‰²ãªã‚“ã§ã™ã‹ï¼Ÿ`,
            `ã‚ãŸã—ã®ã“ã®æœã€\nå®Ÿã¯å‹•ãã‚„ã™ã„ã‚“ã§ã™ã‚ˆã€‚`,

            // --- å¿œæ´ãƒ»ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ ---

            `æ¬¡ã¯ã©ã‚“ãªæ£‹è­œã‚’\nè¦‹ã›ã¦ãã‚Œã‚‹ã‚“ã§ã™ã‹ï¼Ÿ`,

            `ã€Œç‹ã‚ˆã‚Šé£›è»Šã‚’å¯æ„›ãŒã‚‹ã€\nãªã‚“ã¦è¨€ã£ã¡ã‚ƒãƒ€ãƒ¡ã§ã™ã‚ˆï¼Ÿ`,
            `éŠ€ã®å‹•ãã£ã¦ã€å¯æ„›ã„ã§ã™ã‚ˆã­ã€‚`,
 
            `å¯¾å±€ã®å¾Œã®ã‚«ãƒ¬ãƒ¼ã¯ã€\næ ¼åˆ¥ã®å‘³ãŒã—ã¾ã™ã€‚`,
            `é§’ã®éŸ³ã£ã¦ã€\nå¿ƒãŒè½ã¡ç€ãã¾ã›ã‚“ã‹ï¼Ÿ`,
            `é›†ä¸­ã—ã™ãã¦ã€\nç¬ãã‚’å¿˜ã‚Œã¦ã¾ã›ã‚“ã‹ï¼Ÿ`,
            `èƒŒç­‹ã‚’ä¼¸ã°ã™ã¨ã€\nè‰¯ã„æ‰‹ãŒæµ®ã‹ã³ã¾ã™ã‚ˆã€‚`,
            `ä»Šæ—¥ã¯ã©ã‚“ãªåå±€ãŒ\nç”Ÿã¾ã‚Œã‚‹ã‚“ã§ã—ã‚‡ã†ã‹ã€‚`,
            `ç„¡ç†ãªæ”»ã‚ã‚ˆã‚Šã€\nç²˜ã‚Šå¼·ã„å—ã‘ãŒå‹æ©Ÿã‚’å‘¼ã³ã¾ã™ã€‚`,
            `æŒã¡æ™‚é–“ã‚’ä½¿ã„åˆ‡ã‚‹ãã‚‰ã„ã€\nã˜ã£ãã‚Šè€ƒãˆã¡ã‚ƒã„ã¾ã—ã‚‡ã†ï¼`,
            `ãŸã¾ã«ã¯ã€ŒæŠ•äº†ã€ã‚‚å¤§äº‹ãªå‹‡æ°—ã€\nã§ã™ã‚ˆã­â€¦ï¼Ÿ`,

            `ã‚¹ãƒãƒ›ã®ç”»é¢ãŒã€\nå°†æ£‹ç›¤ã«è¦‹ãˆã¦ãã¡ã‚ƒã„ã¾ã—ãŸã€‚`,
  
        ];

        // --- æ™‚é–“å¸¯åˆ¥ã®ã‚»ãƒªãƒ• ---
        let timeMessages = [];
        if (hour >= 5 && hour < 11) {
            // æœ (5:00 - 10:59)
            timeMessages = [
                `ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼\næœã®å°†æ£‹ã¯é ­ãŒå†´ãˆã¾ã™ã­ã€‚`,
                `${userName}ã•ã‚“ã€\næœã”ã¯ã‚“ã¯é£Ÿã¹ã¾ã—ãŸã‹ï¼Ÿ\nç§ã¯ã‚«ãƒ¬ãƒ¼ã§ã—ãŸï¼`,
                `ä»Šæ—¥ã‚‚ä¸€æ—¥ã€\næ¸…ã€…ã—ãæŒ‡ã—ã¾ã—ã‚‡ã†ï¼`
            ];
        } else if (hour >= 11 && hour < 17) {
            // æ˜¼ (11:00 - 16:59)
            timeMessages = [
                `ãŠæ˜¼ä¼‘ã¿ã§ã™ã‹ï¼Ÿ\nå¯¾å±€ã—ã¦ã‹ã‚‰æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ`,
                `åˆå¾Œã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼\nå¿œæ´ã—ã¦ã„ã¾ã™ã­ã€‚`,
                `ã‚ã€ãŠæ˜¼ã”ã¯ã‚“ã®åŒ‚ã„â€¦`
            ];
        } else if (hour >= 17 && hour < 22) {
            // å¤œ (17:00 - 21:59)
            timeMessages = [
                `ä»Šæ—¥ã‚‚ãŠç–²ã‚Œæ§˜ã§ã™ï¼\nä¸€å±€æŒ‡ã—ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚`,
                `å¤œã®é™ã‹ãªå¯¾å±€ã€\nç§ã¯å¤§å¥½ãã§ã™ã‚ˆã€‚`,
                `æ™©ã”ã¯ã‚“ã¯ã€\nã‚‚ã†é£Ÿã¹ã¾ã—ãŸã‹ï¼Ÿ`
            ];
        } else {
            // æ·±å¤œ (22:00 - 4:59)
            timeMessages = [
                `${userName}ã•ã‚“ã€\nå¤œæ›´ã‹ã—ã¯ç¦ç‰©ã§ã™ã‚ˆï¼Ÿ`,
                `ã“ã‚“ãªæ™‚é–“ã¾ã§ç†±å¿ƒã§ã™ã­ã€‚\nâ€¦ç„¡ç†ã¯ã—ãªã„ã§ãã ã•ã„ã­ã€‚`,
                `ç¾Šã‚’æ•°ãˆã‚‹ã‚ˆã‚Šã€\nè©°å°†æ£‹ã‚’è§£ãæ–¹ãŒ\nçœ ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã‚ˆï¼Ÿ`
            ];
        }

        // åŸºæœ¬ã®ã‚»ãƒªãƒ•ã¨æ™‚é–“å¸¯ã‚»ãƒªãƒ•ã‚’åˆä½“ã•ã›ã‚‹
        const charMessages = baseMessages.concat(timeMessages);

        const randomMsg = charMessages[Math.floor(Math.random() * charMessages.length)];
        
        bubble.textContent = randomMsg;
        bubble.style.display = "block";

        clearTimeout(bubbleTimer);
        bubbleTimer = setTimeout(() => {
            bubble.style.display = "none";
        }, 2000);
    }

    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const openMenuId = urlParams.get('open');
      if (openMenuId) {
        const menuEl = document.getElementById(openMenuId);
        if (menuEl) {
          menuEl.style.display = 'flex';
          if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.pathname);
          }
        }
      }
    };
  </script>
</body>
</html>
