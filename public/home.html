<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ã—ãŠã‚„å°†æ£‹ - ãƒ›ãƒ¼ãƒ </title>
  <link rel="icon" href="script/image/komiya_icon.png"> 
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="script/image/komiya_icon.png">
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
      overflow: hidden;
      background-image: url('script/image/shogi_title.PNG'); /* èƒŒæ™¯ç”»åƒ */
      background-color: #2c3e50;
      background-size: cover;
      background-position: center;
      height: 100vh;
      width: 100vw;
    }

    /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰ */
    .character-stand {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      height: 85vh;
      width: auto;
      max-width: 95%;
      pointer-events: none;
      z-index: 1;
      content: url('script/image/komiya_touka.png'); 
      filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
    }

    /* ä¸Šéƒ¨ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒãƒ¼ */
    .user-info-bar {
      position: absolute;
      top: 0;
      width: 100%;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
      z-index: 5;
    }
    .user-name { font-weight: bold; font-size: 1.1rem; }
    
    .top-btn {
      border: none;
      color: white;
      border-radius: 20px;
      padding: 5px 15px;
      font-size: 0.9rem;
      cursor: pointer;
      margin-left: 5px;
      font-weight: bold;
    }
    .stats-btn { background: #ff9800; }
    .news-btn { background: #28a745; }

    /* ä¸‹éƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .bottom-menu {
      position: absolute;
      bottom: 20px;
      width: 96%;
      left: 2%;
      display: flex;
      justify-content: space-around;
      align-items: flex-end;
      gap: 8px;
      z-index: 10;
    }

    .menu-btn {
      flex: 1;
      height: 60px;
      background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
      border: 2px solid white;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .menu-btn:active { transform: scale(0.95); }

    .menu-btn.main-action {
      background: linear-gradient(to bottom, #ff758c 0%, #ff7eb3 100%);
      height: 75px; 
      flex: 1.3;
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    .modal-box {
      background: #fff8dc;
      padding: 20px;
      border-radius: 10px;
      border: 4px solid #8b4513;
      text-align: center;
      width: 85%;
      max-width: 320px;
    }
    .sub-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 1.1rem;
      background: #8b4513;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="user-info-bar">
    <div>
      <span style="font-size:0.8rem; color:#ccc;">Player Name</span><br>
      <span id="userNameDisplay" class="user-name">ã‚²ã‚¹ãƒˆ</span> ã•ã‚“
      <button id="editNameBtn" onclick="showNameEditModal()" style="display:none; background:none; border:none; cursor:pointer; font-size:1rem;">âœï¸</button>
    </div>

    <div>
      <button class="top-btn news-btn" onclick="openModal('newsModal')">ãŠçŸ¥ã‚‰ã›</button>
      <button class="top-btn stats-btn" onclick="showMyStats()">æˆ¦ç¸¾</button>
      <button class="top-btn" style="background: #6c757d;" onclick="openModal('settingsMainMenu')">âš™ï¸</button>
    </div>
  </div>

  <img class="character-stand" src="script/image/char_a.png" alt="Character">

  <div class="bottom-menu">
    <button class="menu-btn" onclick="goToCharacterSelect('practice')">ã‚Œã‚“ã—ã‚…ã†</button>
    <button class="menu-btn" onclick="goToCharacterSelect('cpu')">ã²ã¨ã‚Šã§</button>
    <button class="menu-btn main-action" onclick="goToCharacterSelect('online')">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³<br>å¯¾æˆ¦</button>
    <button class="menu-btn" onclick="goToCharacterSelect('pvp')">ãµãŸã‚Šã§</button>
  </div>

  <div id="newsModal" class="overlay">
    <div class="modal-box">
      <h3 style="color:#d35400; margin-top:0;">ğŸ”” æœ€æ–°æƒ…å ±</h3>
      <div style="text-align: left; margin: 20px 0; line-height: 1.6; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 5px;">
        ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ å®Ÿè£…ï¼<br>
        ãƒ»æœ€å¼·CPUã€Œè©¦é¨“å®Ÿè£…ã€è¿½åŠ <br>
        ãƒ»æˆ¦ç¸¾ä¿å­˜æ©Ÿèƒ½ã«å¯¾å¿œ
      </div>
      <button onclick="closeModal('newsModal')" style="background: #ccc; border: none; color: black; padding: 10px 20px; border-radius: 5px; cursor: pointer;">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <div id="settingsMainMenu" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">è¨­å®š</h3>
      <button class="sub-btn" onclick="switchModal('settingsMainMenu', 'volumeMenu')">ğŸ”Š éŸ³é‡è¨­å®š</button>
      <button class="sub-btn" onclick="switchModal('settingsMainMenu', 'languageMenu')">ğŸŒ è¨€èªè¨­å®š</button>
      <button class="sub-btn" onclick="openAccountFromSettings()">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</button>
      <button class="sub-btn" style="background:#666;" onclick="closeModal('settingsMainMenu')">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <div id="volumeMenu" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">éŸ³é‡è¨­å®š</h3>
      <div style="margin: 20px 0;">
        <p>BGM</p>
        <input type="range" style="width:80%;">
        <p>åŠ¹æœéŸ³</p>
        <input type="range" style="width:80%;">
      </div>
      <button class="sub-btn" style="background:#666;" onclick="switchModal('volumeMenu', 'settingsMainMenu')">ã‚‚ã©ã‚‹</button>
    </div>
  </div>

  <div id="languageMenu" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">è¨€èªè¨­å®š / Language</h3>
      <button class="sub-btn">æ—¥æœ¬èª</button>
      <button class="sub-btn" style="background:#555;">English (Coming Soon)</button>
      <button class="sub-btn" style="background:#666;" onclick="switchModal('languageMenu', 'settingsMainMenu')">ã‚‚ã©ã‚‹</button>
    </div>
  </div>

  <div id="authModal" class="overlay">
    <div class="modal-box">
      <h2 id="authTitle" style="margin-top: 0; color: #8b4513;">ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h2>
      <div id="authInputs">
        <div style="text-align: left; margin: 15px 0;">
          <label>ãŠåå‰ï¼ˆæ–°è¦ç™»éŒ²æ™‚ã®ã¿ï¼‰</label><br>
          <input type="text" id="authName" placeholder="ã‚ãã‚‰" style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div style="text-align: left; margin: 15px 0;">
          <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><br>
          <input type="email" id="authEmail" placeholder="example@mail.com" style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div style="text-align: left; margin: 15px 0;">
          <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰</label><br>
          <input type="password" id="authPass" placeholder="******" style="width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;">
          <button onclick="loginUser()" style="background: #007bff; color: white; width: 45%; height: 40px; border:none; border-radius:5px;">ãƒ­ã‚°ã‚¤ãƒ³</button>
          <button onclick="registerUser()" style="background: #28a745; color: white; width: 45%; height: 40px; border:none; border-radius:5px;">æ–°è¦ç™»éŒ²</button>
        </div>
      </div>
      <div style="margin-top:20px; border-top:1px solid #ccc; padding-top:10px;">
         <button id="logoutBtnInModal" onclick="logoutUser(); closeAuthModal()" style="display:none; background: #6c757d; border:none; border-radius:5px; color: white; width: 100%; height: 40px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
      <button onclick="closeAuthModal()" style="margin-top: 15px; background: #ccc; border: none; padding: 5px 15px; border-radius: 5px;">ã‚‚ã©ã‚‹</button>
    </div>
  </div>

  <div id="nameEditModal" class="overlay">
    <div class="modal-box">
      <h3 style="color: #8b4513; margin-top: 0;">åå‰ã‚’å¤‰æ›´</h3>
      <div style="margin: 20px 0;">
        <input type="text" id="newNameInput" style="width: 80%; padding: 10px; font-size: 16px; border: 2px solid #8b4513; border-radius: 5px; text-align: center;">
      </div>
      <div style="display: flex; justify-content: space-around; gap: 10px;">
        <button onclick="saveNewName()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; flex: 1;">æ±ºå®š</button>
        <button onclick="closeNameEditModal()" style="background: #ccc; color: black; border: none; padding: 10px 20px; border-radius: 5px; flex: 1;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>

  <div id="statsModal" class="overlay">
    <div class="modal-box" style="max-height: 80vh; display: flex; flex-direction: column;">
      <h2 style="margin-top: 0; color: #8b4513;">ã‚ãªãŸã®æˆ¦ç¸¾</h2>
      <div style="display: flex; justify-content: space-around; font-size: 24px; margin-bottom: 15px;">
        <div style="color: red;">å‹: <span id="statsWin">0</span></div>
        <div style="color: blue;">æ•—: <span id="statsLose">0</span></div>
      </div>
      <div style="text-align: left; background: white; border: 1px solid #ccc; flex-grow: 1; overflow-y: auto; padding: 10px; margin-bottom: 15px;">
        <ul id="statsHistory" style="list-style: none; padding: 0; margin: 0;"></ul>
      </div>
      <button onclick="closeStatsModal()" style="background: #ccc; border: none; color: black; padding: 10px;">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <script src="script/auth.js"></script>
  <script>
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function switchModal(closeId, openId) { closeModal(closeId); openModal(openId); }

    function openAccountFromSettings() {
      closeModal('settingsMainMenu');
      showAuthModal(); // auth.jsã®é–¢æ•°
    }

    function goToCharacterSelect(mode) { window.location.href = "character.html?mode=" + mode; }

    function startGame(difficulty) {
      let target = "";
      if (difficulty === 'saijaku') target = "cpu_tawamure.html";
      else if (difficulty === 'easy') target = "cpu_oasobi.html";
      else if (difficulty === 'normal') target = "cpu_tashinami.html";
      else if (difficulty === 'hard1') target = "cpu_komiya.html";
      else if (difficulty === 'hard2') target = "cpu_shioya.html";
      else if (difficulty === 'ex_hard1') target = "ex_cpu_komiya.html";
      else if (difficulty === 'ex_hard2') target = "ex_cpu_shioya.html";
      else if (difficulty === 'ex_hard3') target = "cpu_yaneuraou.html";
      if(target) window.location.href = target;
    }

    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const openMenuId = urlParams.get('open');
      if (openMenuId) {
        const menuEl = document.getElementById(openMenuId);
        if (menuEl) {
          menuEl.style.display = 'flex';
          if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.pathname);
          }
        }
      }
    };
  </script>
</body>
</html>
