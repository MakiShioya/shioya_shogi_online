<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã—ãŠã‚„å°†æ£‹</title> <link rel="stylesheet" href="script/style.css">
  <link rel="icon" href="script/image/komiya_icon.png"> 
</head>
<body>
<div id="game">

  <div class="side left">
    <div class="hand white-hand" id="whiteHandBox">
      <h3>å¾Œæ‰‹ã®æŒã¡é§’</h3>
      <div id="whiteHand"></div>
    </div>
    <button id="undoBtn" class="square-btn" onclick="undoMove()">å¾…ã£ãŸ</button>
  </div>

  <div id="center">
    <div id="status"></div>

    <div id="timerBox" style="font-weight: bold; font-size: 18px; margin: 5px 0; color: #333;">
      è€ƒæ…®æ™‚é–“: 0ç§’
    </div>

    <div id="checkStatus"></div>
    
    <div style="position: relative; display: inline-block;">
      <img id="skillCutIn" src="" alt="">
      <table id="board"></table>
    </div>
    
    <div style="position: absolute; bottom: -90px; left: 0; width: 100%; text-align: center; pointer-events: none;">
    </div>
  </div>

  <div class="side right">
    <button id="resignBtn" class="square-btn">æŠ•äº†</button>
    <div class="hand black-hand" id="blackHandBox">
      <h3>å…ˆæ‰‹ã®æŒã¡é§’</h3>
      <div id="blackHand"></div>
    </div>
  </div>

</div>

<button id="skillBtn" class="square-btn" style="display: none; margin-top: 15px;" onclick="toggleSkillMode()">å¿…æ®ºæŠ€</button>
<div style="text-align: center; margin: 15px 0 10px 0;">
    <button onclick="toggleKifu()" style="padding: 8px 16px; font-size: 14px; cursor: pointer; background-color: #fff; border: 2px solid #333; border-radius: 5px; font-weight: bold;">
        ğŸ“ æ£‹è­œã‚’è¡¨ç¤º / éè¡¨ç¤º
    </button>
</div>

<div id="kifuArea" style="display: none;">
    <div style="width: 100%; max-width: 600px; margin: 0 auto; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
            <span style="font-weight: bold; color: #333;">ã€ æ£‹è­œ ã€‘</span>
            <button onclick="copyKifuText()" style="padding: 4px 10px; font-size: 12px; cursor: pointer;">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
        </div>
        <div id="kifu" style="width: 100% !important; height: 200px; box-sizing: border-box; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #deb887; margin-top: 0; font-family: monospace; font-size: 14px; line-height: 1.6; color: #000; text-align: left;"></div>
    </div>
</div>

<div id="skillModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <p style="font-size: 20px; font-weight: bold; margin-bottom: 20px;">å¿…æ®ºæŠ€ã‚’ç™ºå‹•ã—ã¾ã™ã‹ï¼Ÿ</p>
    <div class="modal-buttons">
      <button class="square-btn" style="background: red; color: white;" onclick="confirmSkillActivate()">ç™ºå‹•</button>
      <button class="square-btn" style="background: gray; color: white;" onclick="closeSkillModal()">ã‚„ã‚ã‚‹</button>
    </div>
  </div>
</div>

<div id="promoteModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <p style="font-size: 20px; font-weight: bold; margin-bottom: 20px;">æˆã‚Šã¾ã™ã‹ï¼Ÿ</p>
    <div class="modal-buttons">
      <button class="square-btn" style="background: #ff4500; color: white;" onclick="resolvePromotion(true)">æˆ</button>
      <button class="square-btn" style="background: gray; color: white;" onclick="resolvePromotion(false)">ä¸æˆ</button>
    </div>
  </div>
</div>

<div id="resignModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <p style="font-size: 20px; font-weight: bold; margin-bottom: 20px;">æŠ•äº†ã—ã¾ã™ã‹ï¼Ÿ</p>
    <div class="modal-buttons">
      <button class="square-btn" style="background: red; color: white;" onclick="executeResign()">æŠ•äº†</button>
      <button class="square-btn" style="background: gray; color: white;" onclick="closeResignModal()">ã‚„ã‚ã‚‹</button>
    </div>
  </div>
</div>

<audio id="skillSound" src=""></audio>
<audio id="bgm" src="script/audio/natsu2.mp3" loop></audio>
<audio id="moveSound" src="script/audio/move.mp3"></audio>
<audio id="promoteSound" src="script/audio/promote.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="script/auth.js"></script>

<script src="script/globals.js"></script>
<script src="script/rules.js"></script>
<script src="script/kifu.js"></script>
<script src="script/sfen_converter.js"></script>
<script src="script/engine_bridge.js"></script>

<script src="script/skills/SilverArmor.js"></script>
<script src="script/characters/Itsumono.js"></script>
<script src="script/skills/PassionateSupport.js"></script>
<script src="script/characters/Nekketsu.js"></script>
<script src="script/skills/BluePrint.js"></script>
<script src="script/characters/Reisei.js"></script>

<script>
  // å¯¾æˆ¦ç›¸æ‰‹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  const opponents = {
    // ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰
    'saijaku': { name: 'ãŸã‚ã‚€ã‚Œ', script: 'script/ai/ai_Lv1.js' },
    'easy':    { name: 'ãŠã‚ãã³', script: 'script/ai/ai_Lv2.js' },
    'normal':  { name: 'ãŸã—ãªã¿', script: 'script/ai/ai_Lv3.js' },
    
    // ã“ã¿ã‚„ãƒ»ã—ãŠã‚„ç³»
    'hard1':   { name: 'ã“ã¿ã‚„',   script: 'script/ai/ai_komiya.js' },
    'hard2':   { name: 'ã—ãŠã‚„',   script: 'script/ai/ai_shioya.js' },
    
    // EXç³»
    'ex_hard1':{ name: 'ã“ã¿ã‚„EX', script: 'script/ai/ex_ai_komiya.js' },
    'ex_hard2':{ name: 'ã—ãŠã‚„EX', script: 'script/ai/ex_ai_shioya.js' }
    
    // â€»ã€Œã‚„ã­ã†ã‚‰ç‹(ex_hard3)ã€ã¯ã‚·ã‚¹ãƒ†ãƒ ãŒå¤§ããé•ã†ãŸã‚ã€
    // ç¾çŠ¶é€šã‚Š cpu_yaneuraou.html ã‚’ä½¿ã„ã¾ã™ã€‚
  };

  // 1. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(?opponent=xxx) ã‚’å–å¾—
  const params = new URLSearchParams(window.location.search);
  const opKey = params.get('opponent');
  const data = opponents[opKey];

  // 2. ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚Œã°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  if (data) {
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚»ãƒƒãƒˆï¼ˆmain.jsãŒã“ã‚Œã‚’ä½¿ã„ã¾ã™ï¼‰
    window.opponentName = data.name;
    document.title = "ã—ãŠã‚„å°†æ£‹ vs " + data.name;

    // 3. AIã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‹•çš„ã«ç”Ÿæˆã—ã¦è¿½åŠ 
    const aiScript = document.createElement('script');
    aiScript.src = data.script;
    
    // AIã®èª­ã¿è¾¼ã¿ãŒçµ‚ã‚ã£ãŸã‚‰ã€æœ€å¾Œã« main.js ã‚’èª­ã¿è¾¼ã‚€ï¼ˆé †åºä¿è¨¼ã®ãŸã‚ï¼‰
    aiScript.onload = function() {
      const mainScript = document.createElement('script');
      mainScript.src = "script/main.js";
      document.body.appendChild(mainScript);
    };
    
    document.body.appendChild(aiScript);
  } else {
    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆï¼ˆç›´æ¥é–‹ã„ãŸæ™‚ãªã©ï¼‰ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    alert("å¯¾æˆ¦ç›¸æ‰‹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚Šã¾ã™ã€‚");
    window.location.href = "home.html";
  }
</script>

</body>
</html>
